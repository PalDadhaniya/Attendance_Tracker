{% extends "base.html" %}
{% block title %}Monthly Report{% endblock %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-3">
  <div>
    <h1 class="h4 mb-0">Monthly Attendance Report</h1>
    {% if is_admin_view %}
      <div class="text-muted small">Report for {{ employee.user.first_name }} {{ employee.user.last_name }} ({{ employee.employee_id }}) - {{ month }}</div>
    {% else %}
      <div class="text-muted small">This monthâ€™s records (up to today)</div>
    {% endif %}
  </div>
  {% if is_admin_view %}
    <a class="btn btn-outline-secondary btn-sm" href="{% url 'admin_view_employees' %}">Back to Employees</a>
  {% else %}
    <a class="btn btn-outline-secondary btn-sm" href="{% url 'dashboard' %}">Back</a>
  {% endif %}
</div>

<!-- Month Selector for Employee Side -->
{% if not is_admin_view %}
<div class="card mb-4 shadow-sm">
  <div class="card-body">
    <div class="row align-items-center">
      <div class="col-md-6">
        <h5 class="card-title mb-0">
          <i class="fas fa-calendar-alt text-primary me-2"></i>
          Select Month & Year
        </h5>
      </div>
      <div class="col-md-6">
        <form method="get" class="d-flex gap-3 justify-content-end align-items-center">
          <div class="d-flex gap-2 align-items-center">
            <div class="form-group mb-0">
              <select name="month" class="form-select">
                <option value="1" {% if selected_month == 1 %}selected{% endif %}>January</option>
                <option value="2" {% if selected_month == 2 %}selected{% endif %}>February</option>
                <option value="3" {% if selected_month == 3 %}selected{% endif %}>March</option>
                <option value="4" {% if selected_month == 4 %}selected{% endif %}>April</option>
                <option value="5" {% if selected_month == 5 %}selected{% endif %}>May</option>
                <option value="6" {% if selected_month == 6 %}selected{% endif %}>June</option>
                <option value="7" {% if selected_month == 7 %}selected{% endif %}>July</option>
                <option value="8" {% if selected_month == 8 %}selected{% endif %}>August</option>
                <option value="9" {% if selected_month == 9 %}selected{% endif %}>September</option>
                <option value="10" {% if selected_month == 10 %}selected{% endif %}>October</option>
                <option value="11" {% if selected_month == 11 %}selected{% endif %}>November</option>
                <option value="12" {% if selected_month == 12 %}selected{% endif %}>December</option>
              </select>
            </div>
            <div class="form-group mb-0">
              <select name="year" class="form-select">
                {% for year in years %}
                <option value="{{ year }}" {% if selected_year == year %}selected{% endif %}>{{ year }}</option>
                {% endfor %}
              </select>
            </div>
          </div>
          <button type="submit" class="btn btn-primary">
            <i class="fas fa-search me-2"></i>Show Data
          </button>
        </form>
      </div>
    </div>
  </div>
</div>
{% endif %}

{% if is_admin_view %}
<!-- Monthly Summary Cards -->
<div class="row mb-4">
  <div class="col-md-3">
    <div class="card text-center">
      <div class="card-body">
        <h5 class="card-title text-primary">{{ total_days }}</h5>
        <p class="card-text">Total Days</p>
      </div>
    </div>
  </div>
  <div class="col-md-3">
    <div class="card text-center">
      <div class="card-body">
        <h5 class="card-title text-success">{{ present_days }}</h5>
        <p class="card-text">Present Days</p>
      </div>
    </div>
  </div>
  <div class="col-md-3">
    <div class="card text-center">
      <div class="card-body">
        <h5 class="card-title text-danger">{{ absent_days }}</h5>
        <p class="card-text">Absent Days</p>
      </div>
    </div>
  </div>
  <div class="col-md-3">
    <div class="card text-center">
      <div class="card-body">
        <h5 class="card-title text-info">{{ total_hours|default:"00:00:00" }}</h5>
        <p class="card-text">Total Hours</p>
      </div>
    </div>
  </div>
</div>
{% endif %}

<div class="card shadow-sm border-0">
  <div class="card-body">
    <div class="table-responsive">
      <table class="table table-hover align-middle mb-0">
        <thead class="monthly-report-header">
          <tr>
            <th style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px; border: none;">Date</th>
            <th style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); color: white; font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px; border: none;">Check In</th>
            <th style="background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%); color: white; font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px; border: none;">Check Out</th>
            <th style="background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%); color: white; font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px; border: none;">Working Hours</th>
            <th style="background: linear-gradient(135deg, #fa709a 0%, #fee140 100%); color: white; font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px; border: none;">Status</th>
          </tr>
        </thead>
        <tbody>
          {% for r in records %}
            <tr>
              <td class="fw-semibold">{{ r.date }}</td>
              <td>{{ r.check_in|date:"H:i:s" }}</td>
              <td>{% if r.check_out %}{{ r.check_out|date:"H:i:s" }}{% else %}--{% endif %}</td>
              <td>{{ r.working_hours_display }}</td>
              <td>
                {% if r.check_out %}
                  <span class="badge text-bg-success">Completed</span>
                {% else %}
                  <span class="badge text-bg-warning">In Progress</span>
                {% endif %}
              </td>
            </tr>
          {% empty %}
            <tr><td colspan="5" class="text-muted text-center py-4">No attendance records found for this month.</td></tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>
</div>
{% endblock %}