{% extends "base.html" %}
{% block title %}Employee Overview{% endblock %}

{% block content %}
<div class="d-flex flex-wrap justify-content-between align-items-center gap-2 mb-3">
  <div>
    <h1 class="h4 mb-0">Employee Overview</h1>
    <div class="text-muted small">
      {{ employee.employee_id }} • {{ employee.user.first_name }} {{ employee.user.last_name }}
    </div>
  </div>
  <div class="d-flex flex-wrap gap-2">
    <a class="btn btn-outline-secondary btn-sm" href="{% url 'admin_employee_attendance' employee.employee_id %}">Attendance</a>
    <a class="btn btn-outline-primary btn-sm" href="{% url 'admin_employee_details' employee.employee_id %}">Edit</a>
    <a class="btn btn-outline-secondary btn-sm" href="{% url 'admin_dashboard' %}">Back</a>
  </div>
</div>

<div class="row g-3">
  <div class="col-12 col-lg-5">
    <div class="card shadow-sm border-0">
      <div class="card-body">
        <h2 class="h6 mb-3">Leave Balances</h2>
        <div class="table-responsive" style="max-height: 300px; overflow-y: auto;">
          <table class="table table-sm align-middle mb-0">
            <thead class="table-light">
              <tr>
                <th>Type</th>
                <th class="text-end">Total</th>
                <th class="text-end">Used</th>
                <th class="text-end">Remaining</th>
              </tr>
            </thead>
            <tbody>
              {% for lb in leave_balances %}
                <tr>
                  <td>{{ lb.leave_type.name }}</td>
                  <td class="text-end">{{ lb.total }}</td>
                  <td class="text-end">{{ lb.used }}</td>
                  <td class="text-end fw-semibold">{{ lb.remaining }}</td>
                </tr>
              {% empty %}
                <tr><td colspan="4" class="text-muted text-center py-3">No balances</td></tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>

  <div class="col-12 col-lg-7">
    <div class="card shadow-sm border-0">
      <div class="card-body">
        <h2 class="h6 mb-3">Leave Requests</h2>
        <div class="table-responsive" style="max-height: 300px; overflow-y: auto;">
          <table class="table table-hover align-middle mb-0">
            <thead class="table-light">
              <tr>
                <th>Type</th>
                <th>Duration</th>
                <th class="text-end">Days</th>
                <th>Dates</th>
                <th>Status</th>
              </tr>
            </thead>
            <tbody>
              {% for leave in leave_requests %}
                <tr>
                  <td>{{ leave.leave_type.name }}</td>
                  <td>{{ leave.duration_type }}</td>
                  <td class="text-end">{{ leave.total_days }}</td>
                  <td>{{ leave.start_date }} → {{ leave.end_date }}</td>
                  <td>
                    {% if leave.status == "APPROVED" %}
                      <span class="badge text-bg-success">Approved</span>
                    {% elif leave.status == "REJECTED" %}
                      <span class="badge text-bg-danger">Rejected</span>
                    {% else %}
                      <span class="badge text-bg-warning">Pending</span>
                    {% endif %}
                  </td>
                </tr>
              {% empty %}
                <tr><td colspan="5" class="text-muted text-center py-3">No leave requests</td></tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>

  <div class="col-12">
    <div class="card shadow-sm border-0">
      <div class="card-body">
        <div class="d-flex justify-content-between align-items-center mb-2">
          <h2 class="h6 mb-0">Attendance (recent)</h2>
          <a class="btn btn-outline-secondary btn-sm" href="{% url 'admin_employee_attendance' employee.employee_id %}">Open full attendance</a>
        </div>

        <div class="table-responsive" style="max-height: 300px; overflow-y: auto;">
          <table class="table table-hover align-middle mb-0">
            <thead class="table-light">
              <tr>
                <th>Date</th>
                <th>Check In</th>
                <th>Check Out</th>
                <th>Session</th>
                <th>Break</th>
                <th>Working</th>
              </tr>
            </thead>
            <tbody>
              {% for att in attendance_history %}
                <tr>
                  <td class="fw-semibold">{{ att.date }}</td>
                  <td>{{ att.check_in|time:"H:i"|default:"--" }}</td>
                  <td>{{ att.check_out|time:"H:i"|default:"--" }}</td>
                  <td>{{ att.session_hours_display }}</td>
                  <td>{{ att.break_time_display }}</td>
                  <td class="fw-semibold">{{ att.working_hours_display }}</td>
                </tr>
              {% empty %}
                <tr><td colspan="6" class="text-muted text-center py-3">No attendance records</td></tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>
</div>
{% endblock %}